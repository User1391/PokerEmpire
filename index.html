<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Empire</title>
    <style>
        #gameLog {
            width: 100%;
            height: 150px; /* Set the height of the log area */
            border: 1px solid #ccc;
            padding: 5px;
            overflow-y: auto; /* Enable vertical scrolling */
            background-color: #f9f9f9;
            font-family: monospace;
            position: relative;
        }
        #gameLog p {
            margin: 0;
        }
        .gain {
            color: green;
        }

        .loss {
            color: red;
        }
        #logContainer {
            position: relative;
            width: 50%;

        }
        /* janky but seems to work*/
        #btnClearLog {
            position: absolute;
            top: 30%;
            right: 5px;
            cursor: pointer;
            z-index: 1; /* Ensure it stays on top of other content */
        }
        #controls {
            display: flex;
            align-items: center;
        }

        #elBuyInContainer {
            margin-left: 10px;
        }
    </style>
</head>
<body>
<h1>Poker Empire</h1>
<div id="elMoneyContainer"> Cash: $<span id="elMoney"></span></div>
<br>
<div id="controls">
    <button id="btnPlayGame" onclick="game.playGame()">Play Poker</button>
    <div id="elBuyInContainer"> Buy-in: $<span id="elBuyIn"></span></div>
</div>
<br>
<div id="logContainer">
    <h2>Log</h2>
    <div id="gameLog">
    </div>
    <button id="btnClearLog" onclick="game.clearLog()">Clear Log</button>
</div>

<script>
    var data = {
        name: "Player",
        money: 1000.0,
        ev: -0.1,
        games_played: 0,
        tot_games_played: 0,
        wins: 0,
        losses: 0,
        buy_in: 5.0,
    };

    var game = {
        init() {
            this.elMoney = document.getElementById("elMoney");
            this.gameLog = document.getElementById('gameLog');
            this.btnPlayGame = document.getElementById('btnPlayGame');
            this.elBuyIn = document.getElementById("elBuyIn");

            let userName = prompt("What should we call you?");
            if (userName) {
                data.name = userName;
            }

            this.addLog(`Welcome, ${data.name}. Your journey has begun.`);
            this.updateDisplay();
        },
        tick() {
            data.money += 0; // PLACEHOLDER
            data.tot_money += 0; // PLACEHOLDER
            this.updateDisplay();
        },
        updateDisplay() {
            // show money with exactly 2 decimal places
            this.elMoney.innerText = (Math.round(data.money * 100) / 100).toFixed(2);
            this.elBuyIn.innerText = data.buy_in;
        },
        addLog(message, type='') {
            const logEntry = document.createElement('p');
            logEntry.textContent = message;
            if (type === 'gain') {
                logEntry.classList.add('gain');
            } else if (type === 'loss') {
                logEntry.classList.add('loss');
            }
            this.gameLog.appendChild(logEntry);

            // Scroll to the bottom of the log
            this.gameLog.scrollTop = this.gameLog.scrollHeight;
        },
        clearLog () {
            this.gameLog.innerHTML = '';
        },
        playGame() {
            let outcome = this.simGame();
            if (outcome > 0) {
                data.wins++;
                this.addLog(`${data.name} won $${outcome.toFixed(2)}`, 'gain');
            } else {
                data.losses++;
                this.addLog(`${data.name} lost $${-1*outcome.toFixed(2)}`, 'loss');
            }
            data.money += outcome;
            data.games_played++;
            data.tot_games_played++;
            this.updateDisplay();
        },
        // ALL OF THE IN-GAME THINGS
        simGame() {
            return randomNormal(data.ev * data.buy_in, data.buy_in / 3);
        },
        save (savename = 'my_save') {
            localStorage.setItem(savename, JSON.stringify(savename));
        },
        load (savename = 'my_save') {
            Object.assign(data, JSON.parse(localStorage.getItem(savename) || '{}'));
            this.init();
            this.updateDisplay();
        },
        clearSave(savename = 'my_save') {
            localStorage.setItem(savename, '{}');
            location.reload();
        },
        start() {
            setInterval(() => this.tick(), 1e3);
            setInterval(() => this.save(), 10e3);
        },
    };

    function randomNormal(mean = 0, stdDev = 1) {
        let u1 = Math.random();
        let u2 = Math.random();

        // Box-Muller transform
        let z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);

        // Scale and shift to match desired mean and standard deviation
        return z0 * stdDev + mean;
    }

    game.load();
    game.start();

</script>
</body>
</html>